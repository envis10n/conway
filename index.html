<!DOCTYPE html>
<html>
    <head>
        <title>Conway</title>
        <script>
            "use strict";
            (() => {
            // src/grid.ts
            var GridMapError = class _GridMapError extends Error {
                constructor(err) {
                super(err);
                }
                static OutOfBounds() {
                return new _GridMapError("EOUT_OF_BOUNDS" /* EOUT_OF_BOUNDS */);
                }
            };
            var GridMap = class {
                constructor(width, height, default_value) {
                this.width = width;
                this.height = height;
                this._arr = Array(width * height).fill(default_value);
                }
                *iter() {
                for (let i = 0; i < this._arr.length; i++) {
                    const v = this._arr[i];
                    yield [i, v];
                }
                }
                *iter_coords() {
                for (let i = 0; i < this._arr.length; i++) {
                    const v = this._arr[i];
                    yield [{ x: this.getX(i), y: this.getY(i) }, v];
                }
                }
                getNeighbors(x, y) {
                const res = [];
                for (let iy = -1; iy <= 1; iy++) {
                    if (iy == 0)
                    continue;
                    for (let ix = -1; ix <= 1; ix++) {
                    if (ix == 0)
                        continue;
                    const nx = x + ix;
                    const ny = y + iy;
                    if (nx < 0 || nx >= this.width)
                        continue;
                    if (ny < 0 || ny >= this.height)
                        continue;
                    res.push(this.get(nx, ny));
                    }
                }
                return res;
                }
                getX(idx) {
                return idx % this.width;
                }
                getY(idx) {
                return Math.floor(idx / this.width);
                }
                getIdx(x, y) {
                return x + this.width * y;
                }
                get(x, y) {
                const idx = this.getIdx(x, y);
                if (idx >= this._arr.length || idx < 0)
                    throw GridMapError.OutOfBounds();
                return this._arr[idx];
                }
                set(x, y, value) {
                const idx = this.getIdx(x, y);
                if (idx >= this._arr.length || idx < 0)
                    throw GridMapError.OutOfBounds();
                this._arr[idx] = value;
                }
            };

            // src/utils.ts
            function decodeToString(input) {
                const temp = [];
                for (const v of input) {
                temp.push(v.toString(16).padStart(2, "0"));
                }
                return temp.join("");
            }
            function lerp(t, a, b) {
                return a + t * (b - a);
            }
            var Rng = class _Rng {
                constructor(bits) {
                this.bits = bits || 32;
                if (this.bits % 8 != 0)
                    throw new Error("Bits must be in increments of 8.");
                this.byteLength = this.bits / 8;
                this.RAND_MAX = parseInt("FF".repeat(this.byteLength), 16);
                this.SIGNED_MAX = Math.floor(this.RAND_MAX / 2);
                this.SIGNED_MIN = this.SIGNED_MAX - this.RAND_MAX;
                }
                /**
                 * An 8-bit Rng instance.
                 * @returns {Rng}
                 */
                static Rng8() {
                return new _Rng(8);
                }
                /**
                 * A 16-bit Rng instance.
                 * @returns {Rng}
                 */
                static Rng16() {
                return new _Rng(16);
                }
                /**
                 * A 32-bit Rng instance.
                 * @returns {Rng}
                 */
                static Rng32() {
                return new _Rng(32);
                }
                /**
                 * A 64-bit Rng instance.
                 * @returns {Rng}
                 */
                static Rng64() {
                return new _Rng(64);
                }
                /**
                 * Generate a random value between 0.0 and 1.0 using the crypto library and this instance's bit depth.
                 * @returns {number}
                 */
                random() {
                return parseInt(
                    decodeToString(
                    crypto.getRandomValues(new Uint8Array(this.byteLength))
                    ),
                    16
                ) / this.RAND_MAX;
                }
                randomInt(max = this.SIGNED_MAX, min = this.SIGNED_MIN) {
                if (max > this.SIGNED_MAX || max % 1 != 0)
                    throw new Error(
                    "Maximum should be an integer <= " + this.SIGNED_MAX
                    );
                if (min < this.SIGNED_MIN || min % 1 != 0)
                    throw new Error(
                    "Minimum should be and integer >= " + this.SIGNED_MIN
                    );
                return Math.round(this.random() * (max - min) + min);
                }
                randomUInt(max = this.RAND_MAX, min = 0) {
                if (max > this.RAND_MAX || max % 1 != 0)
                    throw new Error("Maximum should be an integer <= " + this.RAND_MAX);
                if (min < 0 || min % 1 != 0)
                    throw new Error("Minimum should be an integer >= 0");
                return Math.round(this.random() * (max - min) + min);
                }
                randomBool(weight = 0.5) {
                if (weight > 1 || weight < 0)
                    throw new Error("Weight should be a value between 0.0 and 1.0");
                return this.random() <= weight;
                }
                randomGradient(ix, iy) {
                const w = this.RAND_MAX;
                const s = Math.floor(w / 2);
                let a = ix;
                let b = iy;
                a *= 3284157443;
                b = b ^ (a << s | a >> w - s);
                b *= 1911520717;
                a = a ^ (b << 5 | b >> w - s);
                a *= 2048419325;
                let r = a * Math.PI;
                const res = { x: 0, y: 0 };
                res.x = Math.cos(r);
                res.y = Math.sin(r);
                return res;
                }
            };
            var Perlin = class {
                constructor(rand) {
                this.rng = Rng.Rng16();
                this._permutation = [
                    151,
                    160,
                    137,
                    91,
                    90,
                    15,
                    131,
                    13,
                    201,
                    95,
                    96,
                    53,
                    194,
                    233,
                    7,
                    225,
                    140,
                    36,
                    103,
                    30,
                    69,
                    142,
                    8,
                    99,
                    37,
                    240,
                    21,
                    10,
                    23,
                    190,
                    6,
                    148,
                    247,
                    120,
                    234,
                    75,
                    0,
                    26,
                    197,
                    62,
                    94,
                    252,
                    219,
                    203,
                    117,
                    35,
                    11,
                    32,
                    57,
                    177,
                    33,
                    88,
                    237,
                    149,
                    56,
                    87,
                    174,
                    20,
                    125,
                    136,
                    171,
                    168,
                    68,
                    175,
                    74,
                    165,
                    71,
                    134,
                    139,
                    48,
                    27,
                    166,
                    77,
                    146,
                    158,
                    231,
                    83,
                    111,
                    229,
                    122,
                    60,
                    211,
                    133,
                    230,
                    220,
                    105,
                    92,
                    41,
                    55,
                    46,
                    245,
                    40,
                    244,
                    102,
                    143,
                    54,
                    65,
                    25,
                    63,
                    161,
                    1,
                    216,
                    80,
                    73,
                    209,
                    76,
                    132,
                    187,
                    208,
                    89,
                    18,
                    169,
                    200,
                    196,
                    135,
                    130,
                    116,
                    188,
                    159,
                    86,
                    164,
                    100,
                    109,
                    198,
                    173,
                    186,
                    3,
                    64,
                    52,
                    217,
                    226,
                    250,
                    124,
                    123,
                    5,
                    202,
                    38,
                    147,
                    118,
                    126,
                    255,
                    82,
                    85,
                    212,
                    207,
                    206,
                    59,
                    227,
                    47,
                    16,
                    58,
                    17,
                    182,
                    189,
                    28,
                    42,
                    223,
                    183,
                    170,
                    213,
                    119,
                    248,
                    152,
                    2,
                    44,
                    154,
                    163,
                    70,
                    221,
                    153,
                    101,
                    155,
                    167,
                    43,
                    172,
                    9,
                    129,
                    22,
                    39,
                    253,
                    19,
                    98,
                    108,
                    110,
                    79,
                    113,
                    224,
                    232,
                    178,
                    185,
                    112,
                    104,
                    218,
                    246,
                    97,
                    228,
                    251,
                    34,
                    242,
                    193,
                    238,
                    210,
                    144,
                    12,
                    191,
                    179,
                    162,
                    241,
                    81,
                    51,
                    145,
                    235,
                    249,
                    14,
                    239,
                    107,
                    49,
                    192,
                    214,
                    31,
                    181,
                    199,
                    106,
                    157,
                    184,
                    84,
                    204,
                    176,
                    115,
                    121,
                    50,
                    45,
                    127,
                    4,
                    150,
                    254,
                    138,
                    236,
                    205,
                    93,
                    222,
                    114,
                    67,
                    29,
                    24,
                    72,
                    243,
                    141,
                    128,
                    195,
                    78,
                    66,
                    215,
                    61,
                    156,
                    180
                ];
                this._p = new Array(512);
                if (rand) {
                    this._permutation.sort(() => this.rng.randomBool() ? -1 : 1);
                }
                for (let i = 0; i < 256; i++) {
                    this._p[i] = this._permutation[i];
                    this._p[256 + i] = this._p[i];
                }
                }
                get permutation() {
                return new Array(...this._permutation);
                }
                fade(t) {
                return t * t * t * (t * (t * 6 - 15) + 10);
                }
                grad(hash, x, y, z) {
                const h = hash & 15;
                const u = h < 8 ? x : y;
                const v = h < 4 ? y : h == 12 || h == 14 ? x : z;
                return ((h & 1) == 0 ? u : -u) + ((h & 2) == 0 ? v : -v);
                }
                noise(x, y) {
                let z = 10;
                const X = Math.floor(x) & 255;
                const Y = Math.floor(y) & 255;
                const Z = Math.floor(z) & 255;
                x -= Math.floor(x);
                y -= Math.floor(y);
                const u = this.fade(x);
                const v = this.fade(y);
                const w = this.fade(z);
                const A = this._p[X] + Y;
                const AA = this._p[A] + Z;
                const AB = this._p[A + 1] + Z;
                const B = this._p[X + 1] + Y;
                const BA = this._p[B] + Z;
                const BB = this._p[B + 1] + Z;
                return lerp(
                    w,
                    lerp(
                    v,
                    lerp(
                        u,
                        this.grad(this._p[AA], x, y, z),
                        // AND ADD
                        this.grad(this._p[BA], x - 1, y, z)
                    ),
                    // BLENDED
                    lerp(
                        u,
                        this.grad(this._p[AB], x, y - 1, z),
                        // RESULTS
                        this.grad(this._p[BB], x - 1, y - 1, z)
                    )
                    ),
                    // FROM  8
                    lerp(
                    v,
                    lerp(
                        u,
                        this.grad(this._p[AA + 1], x, y, z - 1),
                        // CORNERS
                        this.grad(this._p[BA + 1], x - 1, y, z - 1)
                    ),
                    // OF CUBE
                    lerp(
                        u,
                        this.grad(this._p[AB + 1], x, y - 1, z - 1),
                        this.grad(this._p[BB + 1], x - 1, y - 1, z - 1)
                    )
                    )
                );
                }
            };

            // src/index.ts
            var CanvasRender = class {
                constructor(options = {}) {
                const opts = Object.assign({ width: 512, height: 512, id: "_canvas_render", tileSize: 16 }, options);
                let canvas = document.getElementById(opts.id);
                if (canvas == null) {
                    canvas = document.createElement("canvas");
                    canvas.id = opts.id;
                    canvas.setAttribute("width", opts.width.toString());
                    canvas.setAttribute("height", opts.height.toString());
                    document.body.appendChild(canvas);
                } else {
                    opts.height = parseInt(canvas.getAttribute("height") || "512");
                    opts.width = parseInt(canvas.getAttribute("width") || "512");
                    opts.id = canvas.id;
                }
                this.tileSize = opts.tileSize;
                this.width = opts.width;
                this.height = opts.height;
                this._canvas = canvas;
                const ctx = this._canvas.getContext("2d");
                if (ctx == null)
                    throw new Error("Unable to get context.");
                this._ctx = ctx;
                }
                makeTileSet(fill) {
                return new GridMap(Math.floor(this.width / this.tileSize), Math.floor(this.height / this.tileSize), fill);
                }
                renderMap(map, colorize) {
                for (const [i, t] of map.iter()) {
                    const x = map.getX(i);
                    const y = map.getY(i);
                    const color = colorize(t);
                    this._ctx.fillStyle = color;
                    this._ctx.fillRect(
                    x * this.tileSize,
                    y * this.tileSize,
                    this.tileSize,
                    this.tileSize
                    );
                }
                }
            };
            function getLivingNeighbors(x, y, grid) {
                return grid.getNeighbors(x, y).filter((v) => v == 1 /* Alive */).length;
            }
            function step(grid) {
                for (const [pos, state] of grid.iter_coords()) {
                let _state = state;
                const living = getLivingNeighbors(pos.x, pos.y, grid);
                if (living < 2 || living > 3)
                    _state = 0 /* Dead */;
                else if (_state == 0 /* Dead */ && living == 3)
                    _state = 1 /* Alive */;
                grid.set(pos.x, pos.y, _state);
                }
            }
            window.onload = () => {
                const rng = Rng.Rng16();
                const perlin = new Perlin(true);
                const render = new CanvasRender({ id: "_conway_render", tileSize: 8, width: 1280, height: 512 });
                const map = render.makeTileSet(0 /* Dead */);
                for (const [pos, v] of map.iter_coords()) {
                const n = perlin.noise(pos.x, pos.y);
                if (n >= 0.75)
                    map.set(pos.x, pos.y, 1 /* Alive */);
                }
                function simulate() {
                step(map);
                render.renderMap(map, (v) => {
                    switch (v) {
                    case 0 /* Dead */:
                        return "#FFF";
                    case 1 /* Alive */:
                        return "#000";
                    }
                });
                setTimeout(() => {
                    requestAnimationFrame(simulate);
                }, 1e3 / 60);
                }
                simulate();
            };
            })();
        </script>
        <style>
            canvas {
                display: block;
                border: 2px solid black;
                margin-right: auto;
                margin-left: auto;
            }
        </style>
    </head>
    <body>
    </body>
</html>